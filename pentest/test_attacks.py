#!/usr/bin/env python3
"""Envia diversos payloads e verifica se todos foram registrados."""

ATTACKS = {
    "xss": "<script>alert('XSS')</script>",
    "sqli": "' OR '1'='1' --",
    "path_traversal": "../../../../etc/passwd",
    "cmd_injection": "; cat /etc/passwd",
    "dos": "A" * 5000,
}


def test_multiple_attacks(client):
    for payload in ATTACKS.values():
        client.get(f"/?data={payload}")

    logs = client.get("/api/logs").get_json()
    assert len(logs) == len(ATTACKS)
    seen = {payload: False for payload in ATTACKS.values()}
    for entry in logs:
        log_text = entry.get("log", "")
        for payload in ATTACKS.values():
            if payload in log_text:
                seen[payload] = True
        for key in ("severity", "anomaly", "nids", "intensity"):
            assert key in entry
    assert all(seen.values())
