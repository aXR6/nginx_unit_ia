import http.server
import threading
import subprocess
import time

class Handler(http.server.BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header('Content-Type', 'text/plain')
        self.end_headers()
        self.wfile.write(b'OK')
    def log_message(self, format, *args):
        pass

def test_ab_basic():
    server = http.server.HTTPServer(('127.0.0.1', 8080), Handler)
    thread = threading.Thread(target=server.serve_forever)
    thread.daemon = True
    thread.start()
    time.sleep(0.5)
    try:
        result = subprocess.run(['ab', '-n', '5', 'http://127.0.0.1:8080/'],
                                capture_output=True, text=True, timeout=10)
        assert result.returncode == 0
        assert 'Requests per second' in result.stdout
    finally:
        server.shutdown()
        thread.join()

