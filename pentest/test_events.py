import queue
from app import events


def test_event_notifications():
    log_q = events.register_log_listener()
    blocked_q = events.register_blocked_listener()

    log_entry = {"id": 1, "log": "test"}
    events.notify_log(log_entry)
    received_log = log_q.get(timeout=1)
    assert received_log == log_entry

    block_entry = {"ip": "1.2.3.4", "reason": "test"}
    events.notify_blocked(block_entry)
    received_block = blocked_q.get(timeout=1)
    assert received_block == block_entry

    events.unregister_log_listener(log_q)
    events.unregister_blocked_listener(blocked_q)
