{% extends 'base.html' %}

{% block content %}
<h1 class="h3 mb-3">Logs</h1>
<div class="table-responsive">
    <table class="table table-sm table-bordered" id="logs-table">
        <thead class="table-light">
            <tr>
                <th>Timestamp</th>
                <th>Interface</th>
                <th>Log</th>
                <th>Severity</th>
                <th>Anomaly</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
async function fetchLogs() {
    const res = await fetch('/api/logs');
    const data = await res.json();
    const tbody = document.querySelector('#logs-table tbody');
    tbody.innerHTML = '';
    data.forEach(log => {
        const tr = document.createElement('tr');
        const sevClass = log.severity.label ? 'severity-' + log.severity.label.toLowerCase() : '';
        tr.innerHTML = `
            <td>${log.created_at}</td>
            <td>${log.iface}</td>
            <td>${log.log}</td>
            <td class="${sevClass}">${log.severity.label}</td>
            <td>${log.anomaly.label}</td>
            <td>${log.nids.label}</td>`;
        tbody.appendChild(tr);
    });
}
fetchLogs();
setInterval(fetchLogs, 5000);
</script>
{% endblock %}
